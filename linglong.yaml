version: "1"

package:
  id: com.brave.brave-browser
  name: Brave
  version: 1.85.118.0
  kind: app
  description: |
    Brave浏览器是一款以隐私保护为核心的开源浏览器,由JavaScript之父Brendan Eich团队开发,并同时默认屏蔽追踪器与恶意广告

base: org.deepin.base/25.2.1
runtime: null
command:
  - "/opt/apps/com.brave.brave-browser/files/bin/com.brave.brave-browser"

sources:
    - kind: file
      url: https://github.com/brave/brave-browser/releases/download/v1.85.118/brave-browser-1.85.118-linux-amd64.zip
      digest: 1cb84cbf5693925152c8d48a4ebc9a5a6ff9bd945662a4806cf8a5a2766c2336

build: |
    ## 环境设置
    set -x
    export PATH=$PATH:/usr/libexec/linglong/builder/helper
    # 设置工作目录
    SOURCES="linglong/app-sources"
    # 设置启动二进制文件名称
    BINNAME=${LINGLONG_APPID}
    # 进入工作目录
    cd ${SOURCES}

    # 重命名压缩包
    mv ../sources/*.zip ../sources/target.zip

    # 删除多余目录
    rm -rf ${LINGLONG_APPID}

    # 解压压缩包
    mkdir ${LINGLONG_APPID} && cd ${LINGLONG_APPID} && unzip ../../sources/target.zip
    # 删除多余文件
    rm -rf *.png
    # 退回上一级
    cd ..

    # 写入启动脚本
    echo "#!/bin/bash" > bin/${BINNAME}
    echo "exec \"${PREFIX}/${LINGLONG_APPID}/brave\" \"\$@\"" >> bin/${BINNAME}
    chmod -R 755 *

    # 进行安装
    cp -a bin $PREFIX
    cp -a ${LINGLONG_APPID} $PREFIX
    cp -a share $PREFIX
